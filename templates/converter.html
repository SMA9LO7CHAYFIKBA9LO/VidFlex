{% extends "base.html" %}

{% block title %}MediaFlow â€” Media Converter{% endblock %}
{% block description %}Convert any video or audio file to a different format â€” MP4, MP3, WAV, MKV, AVI and more.{%
endblock %}

{% block content %}

<!-- ===== HERO ===== -->
<section class="hero">
    <div class="hero-bg-orb orb-1" style="background:radial-gradient(circle,#00d4ff,transparent 70%)"></div>
    <div class="hero-bg-orb orb-2" style="background:radial-gradient(circle,#6c63ff,transparent 70%)"></div>
    <div class="container hero-content">
        <h1>Media Format<br /><span class="gradient-text">Converter</span></h1>
        <p class="hero-sub">Upload any audio or video file from your computer and convert it to any format you need â€”
            fast, free, and private.</p>
        <div class="hero-badges">
            <span class="badge">ğŸµ MP3 Â· AAC Â· WAV Â· OGG Â· M4A Â· FLAC</span>
            <span class="badge">ğŸ¬ MP4 Â· MKV Â· AVI Â· MOV Â· WEBM Â· FLV</span>
        </div>
    </div>
</section>

<!-- ===== CONVERTER TOOL ===== -->
<section class="section">
    <div class="container">

        <div class="card">

            <!-- Drop Zone -->
            <div id="cv-dropzone" class="dropzone" role="button" tabindex="0" aria-label="Upload file for conversion">
                <div class="dropzone-inner">
                    <div class="dropzone-icon">ğŸ“</div>
                    <p class="dropzone-text">Drag &amp; drop your file here</p>
                    <p class="dropzone-sub">or</p>
                    <button class="btn-outline" id="cv-browse-btn" type="button">Browse File</button>
                    <input type="file" id="cv-file-input" accept="video/*,audio/*" class="visually-hidden" />
                    <p style="margin-top:.6rem;font-size:.75rem;opacity:.45;">Max file size: 3.5 MB</p>
                </div>
            </div>

            <!-- Size error banner -->
            <div id="cv-size-error"
                style="display:none;margin-top:.75rem;padding:.7rem 1rem;background:rgba(248,113,113,.12);border:1px solid rgba(248,113,113,.35);border-radius:.75rem;color:#f87171;font-size:.875rem;">
                âš ï¸ File is too large for the online converter (max 3.5 MB). Please use a smaller file or run locally.
            </div>

            <!-- Selected File Info -->
            <div id="cv-file-info" class="file-info hidden">
                <div class="file-icon">ğŸ“„</div>
                <div class="file-details">
                    <span id="cv-file-name" class="file-name"></span>
                    <span id="cv-file-size" class="file-size"></span>
                </div>
                <button id="cv-remove-file" class="btn-icon" aria-label="Remove file">âœ•</button>
            </div>

            <!-- Format Picker -->
            <div id="cv-format-picker" class="format-picker hidden">
                <p class="format-picker-label">Choose output format:</p>

                <div class="format-section">
                    <h4 class="format-section-title">ğŸµ Audio Formats</h4>
                    <div class="format-grid">
                        <button class="format-btn" data-format="mp3">MP3</button>
                        <button class="format-btn" data-format="aac">AAC</button>
                        <button class="format-btn" data-format="wav">WAV</button>
                        <button class="format-btn" data-format="ogg">OGG</button>
                        <button class="format-btn" data-format="m4a">M4A</button>
                        <button class="format-btn" data-format="flac">FLAC</button>
                    </div>
                </div>
                <div class="format-section">
                    <h4 class="format-section-title">ğŸ¬ Video Formats</h4>
                    <div class="format-grid">
                        <button class="format-btn" data-format="mp4">MP4</button>
                        <button class="format-btn" data-format="mkv">MKV</button>
                        <button class="format-btn" data-format="avi">AVI</button>
                        <button class="format-btn" data-format="mov">MOV</button>
                        <button class="format-btn" data-format="webm">WEBM</button>
                        <button class="format-btn" data-format="flv">FLV</button>
                    </div>
                </div>

                <button id="cv-convert-btn" class="btn-download" disabled>
                    <span class="btn-download-icon">ğŸ”„</span>
                    <span class="btn-download-text">Convert &amp; Download</span>
                    <span class="btn-spinner hidden" aria-hidden="true"></span>
                </button>
                <p id="cv-status" class="status-msg hidden"></p>
            </div>

        </div><!-- /card -->

        <!-- How-to hint -->
        <div class="hint-row">
            <div class="hint-card">
                <div class="hint-icon">1ï¸âƒ£</div>
                <p>Upload or drag &amp; drop your file</p>
            </div>
            <div class="hint-arrow">â†’</div>
            <div class="hint-card">
                <div class="hint-icon">2ï¸âƒ£</div>
                <p>Choose the output format</p>
            </div>
            <div class="hint-arrow">â†’</div>
            <div class="hint-card">
                <div class="hint-icon">3ï¸âƒ£</div>
                <p>Click <strong>Convert &amp; Download</strong></p>
            </div>
        </div>

    </div>
</section>

<script>
    // File-size guard: block uploads > 3.5 MB (Vercel free plan limit is 4.5 MB)
    const MAX_BYTES = 3.5 * 1024 * 1024; // 3.5 MB

    (function () {
        const fileInput = document.getElementById('cv-file-input');
        const sizeError = document.getElementById('cv-size-error');
        const fileInfo = document.getElementById('cv-file-info');
        const fmtPicker = document.getElementById('cv-format-picker');

        function handleFile(file) {
            sizeError.style.display = 'none';
            if (file && file.size > MAX_BYTES) {
                sizeError.style.display = 'block';
                fileInfo.classList.add('hidden');
                fmtPicker.classList.add('hidden');
                fileInput.value = '';
                return false;
            }
            return true;
        }

        fileInput.addEventListener('change', function () {
            handleFile(this.files[0]);
        });

        const dropzone = document.getElementById('cv-dropzone');
        dropzone.addEventListener('drop', function (e) {
            const file = e.dataTransfer && e.dataTransfer.files[0];
            if (file && !handleFile(file)) e.stopImmediatePropagation();
        }, true);
    })();
</script>

{% endblock %}